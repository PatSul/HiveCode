# Hive Security & Data Privacy Architecture

This document provides a technical deep-dive into the security infrastructure of Hive. It is intended for security reviewers, compliance officers, and users operating in high-sensitivity environments.

---

## Core Philosophy: Local-First, Zero-Trust

Hive is built on the principle that the most secure data is data that never leaves your machine.

- **No Telemetry:** Hive does not phone home with usage stats or metadata.
- **Native Rust:** The entire platform is written in memory-safe Rust, eliminating classes of vulnerabilities common in C++ (buffer overflows) and Electron (XSS/RCE).
- **Binary Integrity:** All scanning happens within the native binary before any network request is serialized.

---

## 1. HiveShield: The 4-Layer Outbound Firewall

HiveShield is an interceptor layer that sits between the AI Agent Swarm and the AI Providers.

### Layer 1: PII Detection (Deterministic & Heuristic)

HiveShield scans every outbound prompt for 11+ types of Personally Identifiable Information (PII), including:

- **Financial:** Credit Card numbers (Luhn check), Bank Account/IBANs.
- **Identity:** SSNs, Passport numbers, Driver's Licenses.
- **Contact:** Emails, Phone numbers, Physical addresses.

**Action:** Users can choose to **Redact**, **Hash**, or **Cloak** (replace with generic placeholders) before the data hits the wire.

### Layer 2: Secrets Scanning (Entropy-Based)

The `hive_shield` crate contains a high-performance scanner that detects:

- **API Keys & Tokens:** AWS, OpenAI, GitHub, Slack, etc.
- **Cryptographic Keys:** Private RSA/EdDSA keys and mnemonic phrases.
- **Risk Scoring:** Secrets are flagged by severity (Critical to Low), blocking the transmission of any "Critical" secret by default.

### Layer 3: Vulnerability & Injection Assessment

Hive analyzes the "Queen's" plan and the agents' responses for:

- **Prompt Injection:** Detecting attempts to bypass system instructions.
- **Jailbreak Detection:** Identifying adversarial patterns designed to ignore safety guardrails.

### Layer 4: Provider Trust-Based Access Control

Data is classified based on the Trust Level of the destination:

| Trust Level | Example | Policy |
|---|---|---|
| **Local** | Ollama, LM Studio | Full data access permitted |
| **Trusted** | Enterprise Azure OpenAI | Standard PII scanning |
| **Untrusted** | Public Beta Models | Strict redaction enforced |

---

## 2. SecurityGateway: Command & Filesystem Protection

Every shell command generated by a HiveMind Team is routed through the `SecurityGateway`.

- **Pre-Execution Hooks:** Commands are parsed and checked against a "Deny-List" (e.g., `rm -rf /`, `curl | sh`, `chmod`).
- **Worktree Isolation:** Agents work in isolated Git worktrees. They cannot modify your main branch without a final user approval.
- **No Hidden Ops:** Every command is displayed in the Monitor Panel for human-in-the-loop verification.

---

## 3. Data Storage & Encryption

Hive stores all configuration and "Collective Memory" in `~/.hive/`.

- **Database:** SQLite is used for local persistence. Sensitive secret material is encrypted separately (see below); full-database encryption is not currently enabled.
- **Key Management:** Provider API keys and wallet private keys are encrypted locally using AES-256-GCM with Argon2id-derived keys (`keys.enc`, `wallets.enc`).
- **No Cleartext Secrets:** API keys and wallet private keys are not stored as plaintext JSON config values.

---

## 4. Compliance & Audit

For enterprise environments, Hive supports:

- **Local Audit Logs:** Every interaction, scan result, and blocked action is logged in `~/.hive/logs/security.log`.
- **Budget Enforcement:** Prevent "Token Exhaustion" attacks or accidental spend via hard-cap budget limits at the Queen level.

---

## Appendix: Enterprise Compliance Checklist

This checklist is provided to assist IT and Compliance departments in evaluating Hive for internal deployment.

### Data Privacy & Sovereignty

- [x] **Local-First Architecture:** All data, configurations, and learning models are stored locally in `~/.hive/`.
- [x] **Zero Telemetry:** Hive does not transmit usage data, metadata, or conversation logs to a central server.
- [x] **PII Masking:** Outbound data is scanned for 11+ types of PII with configurable Redact/Hash/Cloak modes.
- [x] **Secret Interception:** Detects and blocks API keys, private keys, and tokens before transmission.

### Encryption & Storage

- [x] **Secret Encryption at Rest:** API keys and wallet private keys are encrypted at rest using AES-256-GCM.
- [ ] **Full DB Encryption:** SQLite database files are not yet encrypted end-to-end.
- [x] **Secure Key Storage:** Provider API keys are stored in encrypted local storage, not plaintext config.
- [x] **Memory Safety:** Built 100% in Rust, providing compile-time protection against buffer overflows and memory corruption.

### Access & Execution Control

- [x] **Command Filtering:** The SecurityGateway prevents the execution of destructive or unauthorized shell commands.
- [x] **Isolation:** Multi-agent swarm teams operate in isolated Git worktrees to prevent accidental modification of production code.
- [x] **Human-in-the-loop:** Critical actions (file writes, command execution, email sending) require explicit user approval.

### Network & Infrastructure

- [x] **Offline Capability:** Supports air-gapped or internal-only operation via Ollama or LM Studio.
- [x] **Audit Logging:** Detailed local logs of all AI interactions and security interceptions are maintained for 30 days (configurable).
- [x] **Proxy Support:** Respects system-level proxy settings for controlled corporate network egress.
